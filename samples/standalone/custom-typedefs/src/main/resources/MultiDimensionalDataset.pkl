/* SPDX-License-Identifier: Apache-2.0
   Copyright 2024 Atlan Pte. Ltd. */
amends "modulepath:/Model.pkl"

t = "Cube"
a = t.toLowerCase()

local dimension = "Dimension"
local hierarchy = "Hierarchy"
local field = "Field"
local qualifiedName = "QualifiedName"
local supertypeName = "MultiDimensionalDataset"
local attrName = "Name"

shared {
  supertypeDefinition {
    name = supertypeName
    description = "A dataset with multiple dimensions"
    superTypes { "Catalog" }
    attributeDefs {
      new {
        name = "\(a)\(attrName)"
        description = "Simple name of the cube in which this asset exists, or empty if it is itself a cube."
        type = "string"
        indexAs = "both"
      }
      new {
        name = "\(a)\(qualifiedName)"
        description = "Unique name of the cube in which this asset exists, or empty if it is itself a cube."
        type = "string"
        indexAs = "keyword"
      }
      new {
        name = "\(a)\(dimension)\(attrName)"
        description = "Simple name of the cube dimension in which this asset exists, or empty if it is itself a dimension."
        type = "string"
        indexAs = "both"
      }
      new {
        name = "\(a)\(dimension)\(qualifiedName)"
        description = "Unique name of the cube dimension in which this asset exists, or empty if it is itself a dimension."
        type = "string"
        indexAs = "keyword"
      }
      new {
        name = "\(a)\(hierarchy)\(attrName)"
        description = "Simple name of the dimension hierarchy in which this asset exists, or empty if it is itself a hierarchy."
        type = "string"
        indexAs = "both"
      }
      new {
        name = "\(a)\(hierarchy)\(qualifiedName)"
        description = "Unique name of the dimension hierarchy in which this asset exists, or empty if it is itself a hierarchy."
        type = "string"
        indexAs = "keyword"
      }
    }
  }
}

customTypes {
  new {
    assetDefinition {
      name = t
      description = "Instance of a cube in Atlan."
      superTypes { supertypeName }
      attributeDefs {
        new {
          name = "\(a)\(dimension)Count"
          description = "Number of dimensions in the cube."
          type = "long"
        }
      }
    }
  }
  new {
    assetDefinition {
      name = "\(t)\(dimension)"
      description = "Instance of a cube dimension in Atlan."
      superTypes { supertypeName }
      attributeDefs {
        new {
          name = "\(a)\(hierarchy)Count"
          description = "Number of hierarchies in the cube dimension."
          type = "long"
        }
      }
    }
    relationships {
      new {
        description = "Containment relationship between \(t) (parent) and \(t)\(dimension) (children)."
        endDef1 {
          description = "Individual dimensions that make up the cube."
          type = t
          name = "\(a)\(dimension)s"
          isContainer = true
        }
        endDef2 {
          description = "Cube in which this dimension exists."
          type = "\(t)\(dimension)"
          name = a
        }
      }
    }
  }
  new {
    assetDefinition {
      name = "\(t)\(hierarchy)"
      description = "Instance of a cube hierarchy in Atlan."
      superTypes { supertypeName }
      attributeDefs {
        new {
          name = "\(a)\(field)Count"
          description = "Number of total fields in the cube hierarchy."
          type = "long"
        }
      }
    }
    relationships {
      new {
        description = "Containment relationship between \(t)\(dimension) (parent) and \(t)\(hierarchy) (children)."
        endDef1 {
          description = "Individual hierarchies that make up the dimension."
          type = "\(t)\(dimension)"
          name = "\(a)Hierarchies"
          isContainer = true
        }
        endDef2 {
          description = "Dimension in which this hierarchy exists."
          type = "\(t)\(hierarchy)"
          name = "\(a)\(dimension)"
        }
      }
    }
  }
  new {
    assetDefinition {
      name = "\(t)\(field)"
      description = "Instance of a cube field in Atlan."
      superTypes { supertypeName }
      attributeDefs {
        new {
          name = "\(a)Parent\(field)Name"
          description = "Name of the parent field in which this field is nested."
          type = "string"
          indexAs = "both"
        }
        new {
          name = "\(a)Parent\(field)QualifiedName"
          description = "Unique name of the parent field in which this field is nested."
          type = "string"
          indexAs = "keyword"
        }
        new {
          name = "\(a)\(field)Level"
          description = "Level of the field in the cube hierarchy."
          type = "int"
        }
        new {
          name = "\(a)\(field)MeasureExpression"
          description = "Expression used to calculate this measure."
          type = "string"
          indexAs = "both"
        }
        new {
          name = "\(a)\(field)Count"
          description = "Number of sub-fields that are direct children of this field."
          type = "long"
        }
      }
    }
    relationships {
      new {
        description = "Containment relationship between \(t)\(hierarchy) (parent) and \(t)\(field) (children)."
        endDef1 {
          description = "Individual fields that make up the hierarchy."
          type = "\(t)\(hierarchy)"
          name = "\(a)\(field)s"
          isContainer = true
        }
        endDef2 {
          description = "Hierarchy in which this field exists."
          type = "\(t)\(field)"
          name = "\(a)\(hierarchy)"
        }
      }
      new {
        description = "Hierarchical nesting relationship between \(t)\(field)s."
        endDef1 {
          description = "Individual fields nested within this cube field."
          type = "\(t)\(field)"
          name = "\(a)Nested\(field)s"
          isContainer = true
        }
        endDef2 {
          description = "Parent field in which this field is nested."
          type = "\(t)\(field)"
          name = "\(a)Parent\(field)"
        }
      }
    }
  }
}
