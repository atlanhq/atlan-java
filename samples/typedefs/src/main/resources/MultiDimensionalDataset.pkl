/* SPDX-License-Identifier: Apache-2.0
   Copyright 2024 Atlan Pte. Ltd. */
amends "modulepath:/Model.pkl"

t = "Cube"
a = t.toLowerCase()

local dimension = "Dimension"
local hierarchy = "Hierarchy"
local field = "Field"
local qualifiedName = "QualifiedName"
local supertypeName = "MultiDimensionalDataset"
local attrName = "Name"

local cube = new Icon {
  name = "CubeGray"
  nameActive = "Cube"
  svg = "cube-light-gray.svg"
  svgActive = "cube-light.svg"
}
local cubeDimension = new Icon {
  name = "CubeDimensionGray"
  nameActive = "CubeDimension"
  svg = "square-half-light-gray.svg"
  svgActive = "square-half-light.svg"
}
local schema = new Icon {
  name = "SchemaGray"
  nameActive = "Schema"
  svg = "schema-gray.svg"
  svgActive = "schema.svg"
}
local pivotTable = new Icon {
  name = "PivotTable"
  svg = "pivot-table.svg"
}

shared {
  supertypeDefinition {
    name = supertypeName
    description = "A dataset with multiple dimensions"
    superTypes { "Catalog" }
    attributes {
      ["\(a)\(attrName)"] {
        label = "Cube"
        description = "Simple name of the cube in which this asset exists, or empty if it is itself a cube."
        type = "string"
        indexAs = "both"
      }
      ["\(a)\(qualifiedName)"] {
        description = "Unique name of the cube in which this asset exists, or empty if it is itself a cube."
        type = "string"
        indexAs = "keyword"
      }
      ["\(a)\(dimension)\(attrName)"] {
        label = "Dimension"
        description = "Simple name of the cube dimension in which this asset exists, or empty if it is itself a dimension."
        type = "string"
        indexAs = "both"
      }
      ["\(a)\(dimension)\(qualifiedName)"] {
        description = "Unique name of the cube dimension in which this asset exists, or empty if it is itself a dimension."
        type = "string"
        indexAs = "keyword"
      }
      ["\(a)\(hierarchy)\(attrName)"] {
        label = "Hierarchy"
        description = "Simple name of the dimension hierarchy in which this asset exists, or empty if it is itself a hierarchy."
        type = "string"
        indexAs = "both"
      }
      ["\(a)\(hierarchy)\(qualifiedName)"] {
        description = "Unique name of the dimension hierarchy in which this asset exists, or empty if it is itself a hierarchy."
        type = "string"
        indexAs = "keyword"
      }
    }
  }
  ui {
    svgName = "MultiDimensional.svg"
    filters {
      [t] {
        attribute = "\(a)\(qualifiedName)"
      }
      ["\(t)\(dimension)"] {
        attribute = "\(a)\(dimension)\(qualifiedName)"
      }
    }
    breadcrumb {
      [t] {
        q = "\(a)\(qualifiedName)"
        n = "\(a)\(attrName)"
      }
      ["\(t)\(dimension)"] {
        q = "\(a)\(dimension)\(qualifiedName)"
        n = "\(a)\(dimension)\(attrName)"
      }
      ["\(t)\(hierarchy)"] {
        q = "\(a)\(hierarchy)\(qualifiedName)"
        n = "\(a)\(hierarchy)\(attrName)"
      }
    }
  }
}

customTypes {
  [t] {
    label = t
    icon = cube
    description = "Instance of a cube in Atlan."
    attributes {
      ["\(a)\(dimension)Count"] {
        label = dimension.decapitalize()
        description = "Number of dimensions in the cube."
        type = "long"
        childCount = true
      }
    }
  }
  ["\(t)\(dimension)"] {
    label = dimension
    icon = cubeDimension
    description = "Instance of a cube dimension in Atlan."
    parentQualifiedName = "\(a)\(qualifiedName)"
    attributes {
      ["\(a)\(hierarchy)Count"] {
        label = hierarchy.decapitalize()
        description = "Number of hierarchies in the cube dimension."
        type = "long"
        childCount = true
      }
    }
    relationships {
      [a] {
        description = "Containment relationship between \(t) (parent) and \(t)\(dimension) (children)."
        endDef1 {
          description = "Individual dimensions that make up the cube."
          type = t
          name = "\(a)\(dimension)s"
          isContainer = true
        }
        endDef2 {
          description = "Cube in which this dimension exists."
          type = "\(t)\(dimension)"
          name = a
        }
      }
    }
  }
  ["\(t)\(hierarchy)"] {
    label = hierarchy
    labelPlural = "Hierarchies"
    icon = schema
    description = "Instance of a cube hierarchy in Atlan."
    parentQualifiedName = "\(a)\(dimension)\(qualifiedName)"
    attributes {
      ["\(a)\(field)Count"] {
        label = field.decapitalize()
        description = "Number of total fields in the cube hierarchy."
        type = "long"
        childCount = true
      }
    }
    relationships {
      ["\(a)\(dimension)"] {
        description = "Containment relationship between \(t)\(dimension) (parent) and \(t)\(hierarchy) (children)."
        endDef1 {
          description = "Individual hierarchies that make up the dimension."
          type = "\(t)\(dimension)"
          name = "\(a)Hierarchies"
          isContainer = true
        }
        endDef2 {
          description = "Dimension in which this hierarchy exists."
          type = "\(t)\(hierarchy)"
          name = "\(a)\(dimension)"
        }
      }
    }
  }
  ["\(t)\(field)"] {
    label = field
    icon = pivotTable
    description = "Instance of a cube field in Atlan."
    parentQualifiedName = "\(a)\(hierarchy)\(qualifiedName)"
    attributes {
      ["\(a)Parent\(field)Name"] {
        label = "Parent field"
        description = "Name of the parent field in which this field is nested."
        type = "string"
        indexAs = "both"
      }
      ["\(a)Parent\(field)QualifiedName"] {
        description = "Unique name of the parent field in which this field is nested."
        type = "string"
        indexAs = "keyword"
      }
      ["\(a)\(field)Level"] {
        label = "Level"
        description = "Level of the field in the cube hierarchy."
        type = "long"
      }
      ["\(a)\(field)MeasureExpression"] {
        label = "Measure expression"
        description = "Expression used to calculate this measure."
        type = "string"
        indexAs = "both"
      }
      ["\(a)Sub\(field)Count"] {
        label = "sub\(field.decapitalize())"
        description = "Number of sub-fields that are direct children of this field."
        type = "long"
        childCount = true
      }
    }
    relationships {
      ["\(a)\(hierarchy)"] {
        description = "Containment relationship between \(t)\(hierarchy) (parent) and \(t)\(field) (children)."
        endDef1 {
          description = "Individual fields that make up the hierarchy."
          type = "\(t)\(hierarchy)"
          name = "\(a)\(field)s"
          isContainer = true
        }
        endDef2 {
          description = "Hierarchy in which this field exists."
          type = "\(t)\(field)"
          name = "\(a)\(hierarchy)"
        }
      }
      ["\(a)Parent\(field)"] {
        description = "Hierarchical nesting relationship between \(t)\(field)s."
        endDef1 {
          description = "Individual fields nested within this cube field."
          type = "\(t)\(field)"
          name = "\(a)Nested\(field)s"
          isContainer = true
        }
        endDef2 {
          description = "Parent field in which this field is nested."
          type = "\(t)\(field)"
          name = "\(a)Parent\(field)"
        }
      }
    }
  }
}
